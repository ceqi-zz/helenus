package com.ceqi.footballBettingRecommendation.server.scheduledService;

import static java.util.concurrent.TimeUnit.HOURS;

import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.ScheduledFuture;

import javax.servlet.ServletConfig;
import javax.servlet.ServletException;

import com.ceqi.footballBettingRecommendation.server.machineLearningModule.Prediction;
import com.google.gwt.user.server.rpc.RemoteServiceServlet;

public class UpdateControl extends RemoteServiceServlet {
	private final ScheduledExecutorService scheduler = Executors
			.newScheduledThreadPool(1, new DaemonThreadFactory());

	@Override
	public void init(ServletConfig config) throws ServletException {
		super.init(config);
		scheduleGamesAndScores();

	}

	public void scheduleGamesAndScores() {
		final Runnable fetchGamesAndScores = new Runnable() {

			@Override
			public void run() {
				Prediction.init();
				Prediction.generatePredictions();
			}

		};

		final ScheduledFuture<?> fetchGamesAndScoresHandle = scheduler
				.scheduleAtFixedRate(fetchGamesAndScores, 0, 24 * 7, HOURS);
	}
}
